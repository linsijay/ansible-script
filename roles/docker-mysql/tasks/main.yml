---

# ref: https://github.com/gerhard/ansible-docker/blob/master/roles/myapp/tasks/mysql.yml

- name: Check MySQL container status
  shell: "docker ps -a | grep '{{ app_name }}-server' | cat"
  register: server_container_status

- name: Remove MySQL container with same name
  command: docker rm {{ app_name }}-server
  when: server_container_status.stdout.find('Exited ') != -1
  register: server_container_removed

- name: Start new MySQL container
  command: >
    docker run -d
    --name {{ app_name }}-server
    -v {{ mysql_data_container_volume }}:/var/lib/mysql
    -e MYSQL_ROOT_PASSWORD={{ mysql_password }}
    -p 127.0.0.1:{{ mysql_private_port }}:{{ mysql_private_port }}
    {{ mysql_docker_image }}
  when: (server_container_status.stdout.find('Up ') == -1)

